//cookie
(function(factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD
		define(['jquery'], factory);
	} else if (typeof exports === 'object') {
		// CommonJS
		factory(require('jquery'));
	} else {
		// Browser globals
		factory(jQuery);
	}
}(function($) {

	var pluses = /\+/g;

	function encode(s) {
		return config.raw ? s : encodeURIComponent(s);
	}

	function decode(s) {
		return config.raw ? s : decodeURIComponent(s);
	}

	function stringifyCookieValue(value) {
		return encode(config.json ? JSON.stringify(value) : String(value));
	}

	function parseCookieValue(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape...
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}

		try {
			// Replace server-side written pluses with spaces.
			// If we can't decode the cookie, ignore it, it's unusable.
			// If we can't parse the cookie, ignore it, it's unusable.
			s = decodeURIComponent(s.replace(pluses, ' '));
			return config.json ? JSON.parse(s) : s;
		} catch (e) {}
	}

	function read(s, converter) {
		var value = config.raw ? s : parseCookieValue(s);
		return $.isFunction(converter) ? converter(value) : value;
	}

	var config = $.cookie = function(key, value, options) {

		// Write

		if (value !== undefined && !$.isFunction(value)) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires,
					t = options.expires = new Date();
				t.setTime(+t + days * 864e+5);
			}

			return (document.cookie = [
				encode(key), '=', stringifyCookieValue(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path ? '; path=' + options.path : '',
				options.domain ? '; domain=' + options.domain : '',
				options.secure ? '; secure' : ''
			].join(''));
		}

		// Read

		var result = key ? undefined : {};

		// To prevent the for loop in the first place assign an empty array
		// in case there are no cookies at all. Also prevents odd result when
		// calling $.cookie().
		var cookies = document.cookie ? document.cookie.split('; ') : [];

		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = parts.join('=');

			if (key && key === name) {
				// If second argument (value) is a function it's a converter...
				result = read(cookie, value);
				break;
			}

			// Prevent storing a cookie that we couldn't decode.
			if (!key && (cookie = read(cookie)) !== undefined) {
				result[name] = cookie;
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function(key, options) {
		if ($.cookie(key) === undefined) {
			return false;
		}

		// Must not alter options, thus extending a fresh object...
		$.cookie(key, '', $.extend({}, options, {
			expires: -1
		}));
		return !$.cookie(key);
	};

}));
//#cookie

//用户信息
function isLogin(){
    if (typeof(LOGIN_USER_INFO.user_id) == 'undefined') {
        getUserInfo();
    } else {
        if (LOGIN_USER_INFO.user_id == 0) {
            $("#H_no_login").show();
            $("#R_no_login").show();
            $("#H_login").hide();
            $("#R_login").hide();
			$('#no-login-publish').show();
			$('#login-publish').hide();
        } else{
			if (location.href.indexOf('login') >= 0 || location.href.indexOf('register') >= 0) {
				location.href = '/';
			}
            $('.UserInfoName').text(LOGIN_USER_INFO.name);
            if (LOGIN_USER_INFO.message > 0) {
                $('.new-msg-count').text(LOGIN_USER_INFO.message);
            } else {
                $('.new-msg-count').parent().hide();
            }
            $('#UserInfoAvatar').attr('alt', LOGIN_USER_INFO.name);
			$('#UserInfoAvatar').attr('src', LOGIN_USER_INFO.avatar);
			$('.UserInfoUrl').attr('href', LOGIN_USER_INFO.url);
			$('#UserInfoLevel').addClass('icon_lv' + LOGIN_USER_INFO.level);
            $('#UserInfoHumor').text(LOGIN_USER_INFO.humor);
            $('#UserInfoPoint').text(LOGIN_USER_INFO.point);
            $("#H_no_login").hide();
            $("#R_no_login").hide();
            $("#H_login").show();
            $("#R_login").show();
			$('#no-login-publish').hide();
			$('#login-publish').show();
        }
    }
}

//获取登录信息
var LOGIN_USER_INFO = {};
function getUserInfo(){
	$.ajax({
        url: 'https://user.' + document.domain + "/index/loginInfo?t=" + Math.random() + '&_ajax=1',
        dataType: "json",
        type: "get",
        success: function(data) {
            if (data.code==1) {
                LOGIN_USER_INFO = $.extend(LOGIN_USER_INFO, data.data);
                isLogin();
            }
        }
    });
}


$(function() {
	function fixedR(){
		var float = $('#fiex');
	    var float_offset = float.offset();
	    $(window).scroll(function () {
	        if (float.length > 0) {
	            var scrollTop = $(document).scrollTop();
	            if (scrollTop > float_offset.top) {
	                float.addClass('fixed-top');
	            } else {
	                float.removeClass('fixed-top');
	            }
	        }
	    });
	}
	fixedR();//右侧浮动广告
	
	//图片懒加载
	function lzLoad(){
		var line=$(window).scrollTop()+$(window).height();
		$('.content-img img[gifsrc]').each(function(){
			var tthis = $(this);
			var top = tthis.offset().top;
			//console.log(top);
			if (top < line){
				if(tthis.attr('gifsrc')!=undefined){
					var img =new Image();
					if(tthis.attr('width')!='' && tthis.attr('height')!=''){
						var left = (Number(tthis.attr('width'))-50)/2;
						var top = (Number(tthis.attr('height'))+50)/2;
					}else{
						left = 100;
						top = 100;
					}
					if(tthis.parent().find('.gifPlayBtn').length<=0){
						tthis.after('<span class="gifPlayBtn gifLoading" style="margin:-'+top+'px 0 0 '+left+'px"><img src="/static/images/loading.gif"/></span>');
					}
					var thisBtn = tthis.parent().find('.gifLoading');
					img.src =tthis.attr('gifsrc');
					img.onload =function() {
						thisBtn.css('display','none');
						tthis.attr('src',tthis.attr('gifsrc'));
						tthis.removeAttr('gifsrc');
					}
				}
			}else{
				return false;
			}
		});
	}
	lzLoad();
	$(window).scroll(function(){
		lzLoad();
	});
	
	$('.content-img').each(function(){
		var ContentHeight = $(this).height();
		var imgWidth = $(this).find("img:first").width();
		var more = '<div class="more-btn-box" style="width:'+imgWidth+'px"><div class="icon-con more-btn"></div><div class="icon-con shouqi-btn"></div></div>';
		var zoom = '<em class="ContentMore MoreBig" datastate="0"></em>';
		if (ContentHeight>400 && $(this).find('img').attr('gifsrc')==undefined) {
			$(this).prepend(zoom).addClass("imgboxBtn");
			$(this).parent().append(more);
		}
		if($(this).find('a').length>0){
			//$(this).find('a').attr("href",$(this).parents('dd').find('h1 a').attr("href")).removeAttr('target');
			$(this).find('a').removeAttr('href');
		}
	});
	/*function lzLoad(){
		
		$('img[gifsrc]').each(function(){
			if($(this).attr('gifsrc')!=undefined){
				if($(this).attr('width')!='' && $(this).attr('height')!=''){
					var left = (Number($(this).attr('width'))-50)/2;
					var top = (Number($(this).attr('height'))+50)/2;
				}else{
					left = 100;
					top = 100;
				}
				if($(this).parent().find('.gifPlayBtn').length<=0){
					$(this).after('<span class="gifPlayBtn" style="margin:-'+top+'px 0 0 '+left+'px">播放GIF</span>');
				}
			}
		});
	}
	lzLoad();
	
	//gif播放
	$('.gifPlayBtn').on('click',function(){
		var thisBtn = $(this);
		var tthis = thisBtn.parent().find('img');
		thisBtn.addClass("gifLoading");
		thisBtn.html("<img src='/static/images/loading.gif'/>");
		var img =new Image();
		img.src =tthis.attr('gifsrc');
		img.onload =function() {
			thisBtn.css('display','none');
			tthis.attr('src',tthis.attr('gifsrc'));
			tthis.removeAttr('gifsrc');
		}
	})*/
	
	//列表点击放大缩小
	$(".ContentMore").on("click",function(){
		var $img = $(this).parent().find("img");
		var src = $img.attr("src");
		var jpgsrc = $img.attr("jpgsrc");
		if ($(this).attr("datastate")==0) {
			$(this).attr("datastate",1);
			$(this).parent().removeClass("imgboxBtn");
			$(this).removeClass("MoreBig").addClass("MoreSmall");
			$(this).parents("dd").find(".more-btn-box .more-btn").hide().siblings().show();
			$img.attr("src",jpgsrc);
			$img.attr("jpgsrc",src);
			$img.css("height","auto");
		} else{
			$(this).attr("datastate",0);
			$(this).parent().addClass("imgboxBtn");
			$(this).removeClass("MoreSmall").addClass("MoreBig");
			$(this).parents("dd").find(".more-btn-box .shouqi-btn").hide().siblings().show();
			$img.attr("src",jpgsrc);
			$img.attr("jpgsrc",src);
			$img.removeAttr("style");
		}
	})
	$(".more-btn").on("click",function(){
		var $img = $(this).parent().parent().find(".content-img img");
		var src = $img.attr("src");
		var jpgsrc = $img.attr("jpgsrc");
		$(this).hide().siblings().show();
		$(this).parents("dd").find(".ContentMore").removeClass("MoreBig").addClass("MoreSmall").attr("datastate",1);
		$(this).parents("dd").find(".content-img").removeClass("imgboxBtn");
		$img.attr("src",jpgsrc);
		$img.attr("jpgsrc",src);
		$img.css("height","auto");
	})
	$(".shouqi-btn").on("click",function(){
		var $img = $(this).parent().parent().find(".content-img img");
		var src = $img.attr("src");
		var jpgsrc = $img.attr("jpgsrc");
		$(this).hide().siblings().show();
		$(this).parents("dd").find(".ContentMore").removeClass("MoreSmall").addClass("MoreBig").attr("datastate",0);
		$(this).parents("dd").find(".content-img").addClass("imgboxBtn");
		$img.attr("src",jpgsrc);
		$img.attr("jpgsrc",src);
		$img.removeAttr("style");
	})

	//返回顶部
	$(window).on("scroll", function() {
		if ($(window).scrollTop() > 500) {
			$("#fix-area").fadeIn(300);
		} else {
			$("#fix-area").fadeOut(300);
		}
	});
	$("#top").on("click", function() {
		$('body,html').animate({
			scrollTop: 0
		}, 500);
		return false;
	});

	//列表加载用户信息资料
    var load_users = [];
	/*$(".list-item dt").hover(function() {
		var id = $(this).attr("id");
		var tthis = $(this);
		if ($(this).find(".mem-about").length == 0) {
            if (load_users[id]) {
                display_user(tthis, load_users[id]);
            } else {
                normal_ajax("/humor/user/get", {id:id}, 'get', function (data) {
                    if (data.code == 1) {
                        load_users[id] = data.data;
                        display_user(tthis, load_users[id]);
                    }
                });
            }
		} else {
			$(this).find(".mem-about").show();
		}
	}, function() {
		$(this).find(".mem-about").hide();
	});*/

    function display_user(dom, data) {
        var signature = data.signature ? '<p><span>'+data.signature+'</Span></p>' : '';
        var is_follow = data.is_follow ? '<a href="javascript:void(0);" class="email" onclick="cancel($(this))"><i class="iconfont icon-jianshao"></i>取消关注</a>' : '<a href="javascript:void(0);" class="plus" onclick="add($(this))"><i class="iconfont icon-plus"></i>关注</a>';
        var html = '<div class="mem-about"><div class="relative"><p class="user-uname pt20 clearfix"><a href="'+ data.user_url + '" target="_blank">'
			+ data.name + '</a><a class="level_icon icon_lv'+data.level
			+'" target="_blank" href="https://www.pengfu.com/help/2.html"></a></p><p class="gray2 h26 pt5"><span class="pr20">发帖：<i class="red">'
			+ data.humor +' </i></span><span class="pr20">积分：<i class="red">' + data.point + '</i></span></p><p class="clearfix addbtnwrap">'
			+is_follow+'</p><div class="about">'+signature+'</div></div></div>';
        dom.append(html);
        dom.find(".mem-about").show();
    }
    
	//列表加载笑话评论
	$('.commentClick').on('click', showcomment);
	function showcomment() {
		var ison = $(this).attr("ison");
        var dom = $(this).parent().parent().parent().find(".joke-comment-wrap");
		if (ison == 0) {
            dom.show();
			$(this).addClass("red");
			$(this).attr("ison", "1");
		} else {
            dom.hide();
			$(this).removeClass("red");
			$(this).attr("ison", "0");
		}
		//加载评论列表
		var id = $(this).parents(".list-item").attr("id");
		var commentList = $(this).parents(".list-item").find(".comment-list");

		if (commentList.find("li").length <= 0 && commentList.parent().find(".noComment").length==0) {
            normal_ajax(CLIETN_DOMAIN.api + "/humor/getComments", {id:id}, 'get', function (data) {
                if (data.code == 1) {
                    var Data = data.data;
                    var li = "";
                    if (Data.length == 0) {
                        commentList.parent().append("<div class='noComment tc h45'>还没有人评论过，赶快抢沙发吧！</div>");
                    } else {
                        for (var i = Data.length - 1; i >= 0; i--) {
                            comment_list(dom, Data[i]);
                        }
                    }
                }
            });
		}
		return false;
	}

	//comment提交验证
	$(".comment-input-btn").on("click", function() {
        var tthis = $(this);
		var id = tthis.attr("data-id");
		var comment_refer = tthis.parents(".joke-comment-wrap").find(".comment_refer").val();
		var userName = tthis.parents(".joke-comment-wrap").find(".comment_name").val();
		var Comment = tthis.parent().parent().find(".comment-input").val();
		var returnPrefix = '回复@' + userName + ':';
		var commentinputaction = $(this).parent().find(".comment-tip");
		if(Comment.indexOf(returnPrefix) == 0){
			Comment = Comment.substring(returnPrefix.length);
		} else {
			comment_refer = 0;
		}
		if (Comment == '' || Comment == '说点什么吧，期待您的神回复！') {
			tipHidden(commentinputaction,false,'您还没有写评论的内容',2000);
			return false;
		} else if (Comment.length > 300) {
			tipHidden(commentinputaction,false,'最多只能写300字哦~',2000);
			return false;
		} else if (Comment.length < 2) {
			tipHidden(commentinputaction,false,'至少要写两个字吧',2000);
			return false;
		} else {
            tthis.attr("disabled", true).attr('data-old-name', tthis.val()).val('提交中...').css('background', '#bcbcbd');
			var select_user_id = 0;
			var select_user_like = 0;
			var select_user_stamp = 0;
			if ($('.select_user_id').length > 0) {
				select_user_id = tthis.parent().find('.select_user_id').val();
				select_user_like = tthis.parent().find('.select_user_like').val();
				select_user_stamp = tthis.parent().find('.select_user_stamp').val();
			}
            normal_ajax("/humor/humor/comment", {
                id: id,
                content: Comment,
                comment_refer: comment_refer,
				select_user_id : select_user_id,
				select_user_stamp : select_user_stamp,
				select_user_like : select_user_like
            }, 'post', function (data) {
                if (data.code == 1) {
                    comment_list(tthis.parents(".joke-comment-wrap"), data.data);
                    tipHidden(commentinputaction,true,'评论成功！',2000);
					tthis.parent().parent().find(".comment-input").val('');
                }
                tthis.removeAttr("disabled", false).val(tthis.attr('data-old-name')).removeAttr("style");
            });
		}
		return false;
	});
	
	function tipHidden(obj,state,str,time){
		var success = '<i class="icon-tip-suc"></i>';
		var errorTip = '<i class="icon-tip-err"></i>';
		if (state==false) {
			obj.html(errorTip+'<span>'+str+'</span>').show();
		} else{
			obj.html(success+'<span>'+str+'</span>').show();
		}
		setTimeout(function(){
			obj.hide();
		},time);
	}

    $('.comment-page').click(function () {
        var tthis = $(this);
        var humorid = $(this).parents(".joke-comment-wrap").attr("humorid");
        var dom = $(this).parents(".joke-comment-wrap");
        var p = parseInt(tthis.attr('data-p'));
        var CommentNum = Number($("#CommentNum").text());
        var Commentpage = Math.ceil(CommentNum/10);
        if (CommentNum>10) {
            $(".commentPage").show();
        }
        if (p > 0 && p <= Commentpage) {
            dom.append('<div id="CommentONload" class="h40 f14 tc">正在加载...</div>');
            normal_ajax(CLIETN_DOMAIN.api + "/humor/getComments", {id:humorid,p:p}, 'get', function (data) {
                if (data.code == 1) {
                    var Data = data.data;
                    $(".comment-list").html("");
                    for (var i = Data.length - 1; i >= 0; i--) {
                        comment_list(dom, Data[i]);
                    }
                    comment_page_show(p, Commentpage);
                    $("#CommentONload").remove();
                }
            });
        } else {
            comment_page_show(p, Commentpage);
        }
    });

    function comment_page_show(p, max) {
        var prev = $('#CommentPrev');
        var next = $('#CommentNext');
        next.attr('data-p', p + 1);
        prev.attr('data-p', p - 1);
        if (p==max) {
            next.hide();
        } else {
            next.css("display","inline-block");
        }
        if (p==1) {
            prev.hide();
        } else {
            prev.css("display","inline-block");
        }
    }

    function comment_list(dom, data) {
        var commentList = dom.find(".comment-list");
        var content_json = "";
        if (data.content_json) {
            for (var i = 0; i < data.content_json.length - 1; i++) {
                var comment = data.content_json[i];
				var am = comment.amount || 0;
                content_json += '<div class="HFcontent">' +
                    '<p><a href="javascript:void(0);" class="green pr5">'+comment.comment_username+'</a>';
				if (am > 0) {
					content_json += '<span class="comment_red_Bag mr10">打赏了<i class="red">' + am + '</i>元</span>';
				}
				content_json += '<span class="gray">'+comment.comment_floor+'F</span></p>' +
                    '<p>'+comment.comment_content+'</p></div>';
            }
            content_json += '<div>'+data.content_json[data.content_json.length - 1].comment_content+'</div>';
			var amount = data.content_json[data.content_json.length - 1].amount || 0;
        } else {
            return;
        }
        //暂不显示时间
        //var d = new Date(parseInt(data.created_at) * 1000);
        //var date_time = d.getFullYear()+'-'+d.getMonth()+'-'+d.getDate()+' '+d.getHours()+':'+d.getMinutes()+':'+d.getSeconds();
        // '<span class="dp-i-b fl gray2">'+date_time+'</span>' +
        var userComment = '<li>' +
            '<div class="comment-ding fr">' +
                '<span class="f12 gray2 dp-i-b h22 ml10 fr">' + data.floor + 'F</span>' +
                '<a class="comment-reply gray2 dp-i-b h22 ml10 fr" rel="nofollow" href="javascript:void(0);" onclick="commentReply(' + data.comment_id + ', $(this))">回复</a>' +
                '<a class="comment-ding-icon gray2 dp-i-b h22 ml10 fr" rel="nofollow" href="javascript:void(0);" onclick="commentVote(' + data.comment_id + ', $(this))">赞(<i class="orange">' + data.like + '</i>)</a>' +
            '</div><div class="comment-list-content f14"><a href="' + data.user_url + '" class="mem-header fl">' +
                '<img src="'+data.avatar+'" alt="' + data.name + '"></a><div class="comment-username clearfix">' +
                '<a href="' + data.user_url + '" target="_blank" class="green dp-i-b mr15 fl">' + data.name + '</a>';
		if (amount > 0) {
			userComment += '<span class="comment_red_Bag">打赏了<i class="red">'+amount+'</i>元</span>';
		}
		userComment +='</div>' +
            '<div class="comment-content h24">' + content_json +
            '</div>' +
            '</div>' +
            '</li>';
        commentList.prepend(userComment);
        if(dom.find(".noComment").length>0){
            dom.find(".noComment").remove();
        }
		if ($('#funny-like-' + data.comment_id).length > 0) {
			$('#funny-like-' + data.comment_id).text(data.like);
		}
    }
	
	var comment_input_box = $('.comment-input-box');
	//评论
	comment_input_box.find('.comment-input').on('focus', function() {
		if ($(this).val() == $(this).attr('title')) {
			$(this).val('').css('color', '#333')
		}
	});
	comment_input_box.find('.comment-input').on('blur', function() {
		if ($(this).val() == '') {
			$(this).val($(this).attr('title')).css('color', '#a4a4a4')
		}
	});
	comment_input_box.find('.comment-input').on('keyup', function() {
		var textLength = 300 - $(this).val().length;
		if (textLength >= 0) {
			$(this).parent().find(".comment-num").html('还可以输入<span class="comment-num-len red">' + textLength + '</span>字')
		} else {
			$(this).parent().find(".comment-num").html('超出<span class="comment-num-len red">' + (-textLength) + '</span>字')
		}
	});

	
	
	

	//标签随机样式
	$(".hot-tags a").each(function() {
		var randomNum = parseInt(Math.random() * 3 + 1);
		$(this).addClass("tag-level" + randomNum);
	});

	//评论图标点击
	$(".det-commentClick").on("click", function() {
		$(window).scrollTop($('.pfcomment-wrap').offset().top);
	});

	//顶踩
	var cookienID = 'cookienID';
	var cookienState = 'cookienState';
	var voteId = [];
	var voteState = [];
	if ($.cookie(cookienID) != null) {
		$(".list-item").each(function() {
			for (var i = 0; i < $.cookie(cookienID).split(',').length; i++) {
				if ($(this).attr("id") == $.cookie(cookienID).split(',')[i] && $.cookie(cookienState).split(',')[i] == "up") {
					$(this).find('.ding').attr("class", "link");
					$(this).find('.cai').attr("class", "gray");
				}
				if ($(this).attr("id") == $.cookie(cookienID).split(',')[i] && $.cookie(cookienState).split(',')[i] == "down") {
					$(this).find('.ding').attr("class", "gray");
					$(this).find('.cai').attr("class", "link");
				}
			}
		});
	}
	////////
	$('.ding').on("click", function() {
		var id = $(this).parent().parent().parent('.list-item').attr('id');
		var tthis = $(this);
        normal_ajax(CLIETN_DOMAIN.api + "/humor/like", {id:id}, 'get', function (data) {
			if (data.code == 1) {
				votingNum('<b style="color:red;">+1</b>',tthis);
				jokeVote('up', tthis);
			}
        });
		return false;
	});
	$('.cai').on("click", function() {
		var id = $(this).parent().parent().parent('.list-item').attr('id');
		var tthis = $(this);
        normal_ajax(CLIETN_DOMAIN.api + "/humor/stamp", {id:id}, 'get', function (data) {
            if (data.code == 1) {
                votingNum('<b style="color:red;">+1</b>', tthis);
                jokeVote('down', tthis);
            }
        });
		return false;
	});
		//顶踩的动画效果
	function votingNum(Tips, t) {
		var vot_num_dom = $('#voteNum');
		var top = t.offset().top;
		var left = t.offset().left;
		if (vot_num_dom.length <= 0) {
			$('body').append('<div id="voteNum"></div>');
            vot_num_dom = $('#voteNum');
		}
		vot_num_dom.html(Tips).css({
			'display': 'block',
			'top': top,
			'left': left,
			'opacity': 1,
			'-moz-opacity': 1,
			'filter': 'alpha(opacity=100)',
			'font-size': '24px'
		});
		vot_num_dom.stop().animate({
			'z-index': 90,
			'margin': 0,
			'top': top - 35,
			'font-size': '50px',
			'opacity': 0,
			'["-moz-opacity"]': '0',
			'["filter"]': 'alpha(opacity=0)'
		}, 300);
		setTimeout(function() {
			$('#voteNum').css('display', 'none')
		}, 300)

	}
	//笑话顶采提交
	function jokeVote(i, t) {
		var id = t.parent().parent().parent('.list-item').attr('id');
		var this_parent = t.parent().parent().parent('.list-item');

		t.find('em').text(Number(t.find('em').text()) + 1);
		if (i == 'up') {
			//votingNum('<b style="color:red;">+1</b>',t);
			this_parent.find('.ding').off('click').attr("class", "link");
			this_parent.find('.cai').off('click').attr("class", "gray");

		} else {
			//votingNum('<b style="color:red;">+1</b>',t);
			this_parent.find('.ding').off('click').attr("class", "gray");
			this_parent.find('.cai').off('click').attr("class", "link");
		}
		if ($.cookie(cookienID) == null) {
			voteId.push(id);
			voteState.push(i);
		} else {
			voteId = $.cookie(cookienID).split(',');
			voteState = $.cookie(cookienState).split(',');
			voteId.push(id);
			voteState.push(i);
		}
		$.cookie(cookienID, voteId, {
			expires: 365
		});
		$.cookie(cookienState, voteState, {
			expires: 365
		});
	}
	
	
});

//关注
function add(obj){
	var id=obj.attr("userid");
	if (typeof LOGIN_USER_INFO.user_id == 'undefined') {
		layer.alert('请先登录！', {
		  icon: 0,
		  time: 3000,
	  	  btn:0
		});
		return false;
	}else if(LOGIN_USER_INFO.user_id==id){
		layer.alert('不能关注自己！', {
		  icon: 0,
		  time: 3000,
	  	  btn:0
		});
		return false;
	}
	else{
		normal_ajax("/user/follow/add", {id:id}, 'get', function (data) {
	            if (data.code == 1) {
	                obj.attr("onclick","cancel($(this))").css({"background-color":"#ececec","color":"#999999"}).html('-取消关注');
	            }
	        });
	}
}

//取消关注
function cancel(obj){
	if (LOGIN_USER_INFO.user_id==0) {
		layer.alert('请先登录！', {
		  icon: 0,
		  time: 3000,
	 	  btn:0
		});
		return false;
	} else{
		var id=obj.parents("dt").attr("id");
		normal_ajax("/user/follow/delete", {id:id}, 'get', function (data) {
	            if (data.code == 1) {
	                obj.attr("onclick","add($(this))").css({"background-color":"#ff6764","color":"#ffffff"}).html('+ 关注');
	            }
	        });
	}
}

//评论顶采提交
function commentVote(t, dom) {
	var CommentID="";
    normal_ajax(CLIETN_DOMAIN.api + "/comment/like", {id:t}, 'get', function (data) {
        if (data.code == 1) {
            if($.cookie('commentid') == null){
            	CommentID=t;
            	dom.find('i').text(Number(dom.find('i').text()) + 1);
            }else{
            	CommentID = $.cookie('commentid');
            	if(CommentID.indexOf(t)<0){
	            	dom.find('i').text(Number(dom.find('i').text()) + 1);
	            	CommentID=CommentID+','+t;
	            }else{
					//alert("你已经点过赞");
					layer.msg("你已经点过赞");
				}
            }
            $.cookie('commentid', CommentID, {expires: 365});
        }else{
        	layer.msg("你已经点过赞");
        }
    });
    dom.removeAttr("onclick");
	return false;
}

//列表页@评论
function commentReply(t, dom) {
	var thisParent = dom.parent().parent().find('.comment-list-content');
	var userName = thisParent.find('.comment-username').find('a').text();
	var comment_con = thisParent.find('.comment-content div:last-child').text();
	var comment_floor = thisParent.parent().find(".comment-ding span").text();
	var thisInput = thisParent.parent().parent().parent().find('.comment-input');
    dom.parents(".joke-comment-wrap").find(".comment_refer").val(t);
    dom.parents(".joke-comment-wrap").find(".comment_name").val(userName);
    dom.parents(".joke-comment-wrap").find(".comment_con").val(comment_con);
    dom.parents(".joke-comment-wrap").find(".comment_floor").val(comment_floor);
	thisInput.val('回复@' + userName + ':').css('color', '#333');
	thisInput.focus();
	return false;
}
//详细页@评论
function HotcommentReply(t, dom) {
	var thisParent = dom.parent().parent().parent();
	var userName = thisParent.find('.shenhf-name').find('a').text();
	var comment_con = thisParent.find('.shenhf-con').text();
	var comment_floor = thisParent.find("#FloorNone").text();
	var thisInput = $('.comment-input');
    $(".comment_refer").val(t);
    $(".comment_name").val(userName);
    $(".comment_con").val(comment_con);
    $(".comment_floor").val(comment_floor);
	thisInput.val('回复@' + userName + ':').css('color', '#333');
	thisInput.focus();
	return false;
}
//列表页神回复@评论
function ListcommentReply(t, dom) {
	var thisParent = dom.parent().parent().parent();
	var userName = thisParent.find('.shenhf-name').find('a').text();
	var comment_con = thisParent.find('.shenhf-con').text();
	var comment_floor = thisParent.find("#FloorNone").text();
	var thisInput = thisParent.parents('.list-item').find('.joke-comment-wrap .comment-input');
	if(thisParent.parents('.list-item').find('.action .commentClick').attr('ison')==0){
		thisParent.parents('.list-item').find('.action .commentClick').attr('ison',1).addClass('red');
		thisParent.parents('.list-item').find(".joke-comment-wrap").show();
	}
    thisParent.parents('.list-item').find(".joke-comment-wrap .comment_refer").val(t);
    thisParent.parents('.list-item').find(".joke-comment-wrap .comment_name").val(userName);
    thisParent.parents('.list-item').find(".joke-comment-wrap .comment_con").val(comment_con);
    thisParent.parents('.list-item').find(".joke-comment-wrap .comment_floor").val(comment_floor);
	thisInput.val('回复@' + userName + ':').css('color', '#333');
	thisInput.focus();
	return false;
}




//登录输入框效果
function input_value(t) {
	t.find('input').on("focus", function() {
		if ($(this).val() == $(this).attr('title') || $(this).val() == '') {
			$(this).parent('li').find('em').hide();
		}
	});
	t.find('input').on("blur", function() {
		if ($(this).val() == $(this).attr('title') || $(this).val() == '') {
			$(this).val('');
			$(this).parent('li').find('em').show();
		}
	})
}

//登录的文本验证
function login(){
    form_validate($('#JS_form_login'), ['login_name', 'password']);
}
//注册表单验证
function reg(){
    form_validate($('#JS_form_reg'), ['email', 'password', 'passconf', 'name', 'code', 'agreement']);
}

//忘记密码验证
function back_password_email(){
    form_validate($('#JS_form_back_password_email'), ['email', 'code']);
}

//重置密码
function back_password(){
	form_validate($('#JS_form_back_password'), ['password', 'passconf']);
}

function form_validate(form, field) {
    var rules = {
        password : {
            required : true,
            minlength : 6
        },
        passconf : {
            required : true,
			minlength : 6,
            equalTo : '.pasw'
        },
        email : {
            required : true,
            email : true
        },
        name: {
            required: true,
            rangelength: [2, 15]
        },
        code: {
            required: true
        },
        agreement: {
            required: true
        },
        login_name: {
            required: true
        }
    };
    var msgs = {
        password: {
            required: "请输入密码",
            minlength: jQuery.format("密码不能小于{0}个字符")
        },
        passconf: {
            required: "请再次输入密码",
            equalTo: '两次密码不一致'
        },
        email: {
            required: "请输入Email地址",
            email: "请输入正确的email地址"
        },
        name: {
            required: '昵称不能为空',
            rangelength: '昵称应在2-15位之间'
        },
        code: {
            required: "请输入验证码"
        },
        agreement: {
            required: "请仔细阅读注册协议!"
        },
        login_name: {
            required: "请输入邮箱或昵称"
        }
    };
    var rule = {}, msg = {};
    for (var k in field) {
        var v = field[k];
        rule[v] = rules[v];
        msg[v] = msgs[v];
    }
	form.validate({
		onkeyup : false,
		rules:rule,
		messages : msg,
		errorPlacement: function (error, element) {
			if (element.is(':radio') || element.is(':checkbox')) {
				error.appendTo(element.parent());
			} else {
				error.appendTo(element.closest("li"));
			}
		},
		focusInvalid: true,
		success:function(e) {
			e.html('&nbsp;').addClass('valid');
		}
	})
}

//发帖
function publishJoke(obj){
	var humorContent = document.getElementById("humor-content").contentWindow.document.body.innerHTML;
	var humorHeight = document.getElementById("humor-content").contentWindow.document.body.offsetHeight;
	var SubmitBtn = obj.find("button");
    humorContent = Handle.FilterInput(humorContent);
	 if (obj.find("#title").val() == "" || obj.find("#title").val() == "写个又逗比有内涵的标题") {
        layer.msg("写个又逗比有内涵的标题");
    }
    else if (humorContent.replace(/&nbsp;/ig, "").replace(/(\s*)|(\s*)/g, "") == "" || humorContent.replace(/(\s*)|(\s*)/g, "") == MSG.replace(/(\s*)|(\s*)/g, "")) {
        layer.msg("请输入幽默内容");
    }
    else {
    	$("#postcontent").val(humorContent);
    	$("#postcontentHeight").val(humorHeight);
    	SubmitBtn.attr("disabled", 'disabled').attr('data-old-name', SubmitBtn.text()).text('提交中...').css('background', '#bcbcbd');
         normal_ajax(obj.attr("action"), obj.serialize(), 'POST', SubmitBtn);
    }
	return false;
}

var MSG = "您可以在这儿发表笑话与大家分享，发帖成功后能立刻显示在您的乐园，无需等待审核。发表笑话不需要登录（不登录只能发表300字以内的笑话，登录后字数上限为3000，并且可以发表图片）。"+
					"您提交的笑话会在我们审核之后出现在捧腹网上。审核标准为：笑话和图片需有笑点，正文中不能包含邮件地址、电话号码、地址等联系信息，不能与政治相关，不包含色情描写，不带有广告性质。"+
					"赠人玫瑰，手有余香。感谢您对捧腹网友的快乐馈赠！";
var Handle = {
    Regex: { ImgRegexStr: "<img(.*?)src=\"((https:\/\/s\\d+).img.pengfu.(cn|com)/\\d+/(\\d+).(\\w+?))\">",
        GifRegexStr: "<img(.*?)src=\"((https:\/\/img\\d+).pengfu.(cn|com)/middle/\\d+/(\\d+).(\\w+?))\">",
        VedioUbbRegexStr: "\\[swf\\sthumbnail=\"(.*?)\"\\](.*?)\\[/swf\\]"
    },
    Count: 0,
    FilterInput: function (str) {
        str = Handle.FilterHtml(str);
        var ubbs = $("#txtUbbPics").val();
        var result = Handle.Match(str, Handle.Regex.ImgRegexStr, ubbs, false, "");
        result = Handle.Match(result, Handle.Regex.GifRegexStr, ubbs, false, result);
        return result;
    },
    Sync: function (str, picLimitCount) {
        str = Handle.FilterHtml(str);
        Handle.Count = 0;
        var ubbs = $("#txtUbbPics").val();
        var result = Handle.Match(str, Handle.Regex.ImgRegexStr, ubbs, true, "");
        result = Handle.Match(str, Handle.Regex.GifRegexStr, ubbs, true, result);
        $("#txtUbbPics").val(result);
        Handle.Count -= Handle.GetVedioCount(result);
        var count = Number(picLimitCount) - Handle.Count;
        try {
            swfu.customSettings["max_count"] = count;
        } catch (e) {

        }
        return result;
    },
    FilterHtml: function (str) {
        str = str.replace(/<(\/)?p>/gmi, "\r\n");
        str = str.replace(/<(\/)?div>/gmi, "\r\n");
        str = str.replace(/<br>/gmi, "\r\n");
        return str.replace(/<([a-h]|[j-z])[a-z]{0,4}.*?>/ig, "").replace(/<\/([a-h]|[j-z])[\w]{0,4}>/ig, "").trim();
    },
    Match: function (str, regexStr, ubbs, isSync, resultStr) {
        var regex = new RegExp(regexStr, "ig");
        if (!isSync) { resultStr = str; }
        if (regex.test(str)) {
            var matchs = str.match(regex);
            if (isSync) { Handle.Count += matchs.length; }
            for (var i = 0; i < matchs.length; i++) {
                var srcRegex = new RegExp(regexStr, "i");
                var result = srcRegex.exec(matchs[i]);
                var allImgMatch = result[0];
                //var imgSrc = result[2];
                var imgId = result[5];
                if (ubbs.indexOf(imgId) > -1) {
                    var ubbArray = ubbs.split("|");
                    for (var j = 0; j < ubbArray.length; j++) {
                        var ubb = ubbArray[j];
                        if (ubb.indexOf(imgId) > -1) {
                            if (isSync) {
                                resultStr += ubb + "|";
                            }
                            else {
                                resultStr = resultStr.replace(allImgMatch, ubb);
                            }
                        }
                    }
                }
            }
        }
        return resultStr;
    },
    GetVedioCount: function (str) {
        var regex = new RegExp(Handle.Regex.VedioUbbRegexStr, "ig");
        if (regex.test(str)) {
            var matchs = str.match(regex);
            return matchs.length;
        }
        else {
            return 0;
        }
    }
};

//div登高
function DIVHigh(l, r) {
	var lHeight;
	var rHeight;
	lHeight = l.height();
	rHeight = r.height();
	if (lHeight <= rHeight) {
		l.css("height", rHeight);
	} else {
		r.css("height", lHeight);
	}
}

//发帖
function placeholders(i) {
	//发帖
	i.on('focus', function() {
		if ($(this).val() == $(this).attr('title')) {
			$(this).val('').css('color', '#333')
		}
	});
	i.on('blur', function() {
		if ($(this).val() == '') {
			$(this).val($(this).attr('title')).css('color', '#a4a4a4')
		}
	});
}

//访问人数
function visitNum(id) {
	var Array;
	Array = id.text().split("");
	id.empty();
	$.each(Array, function(i, val) {
		id.append("<i>" + val + "</i>");
	});
}

//邀请好友窗口
function invitebox() {
	$(".boxMask").show();
	$("#boxWrap").show().css({
		"margin-left": -$("#boxWrap").width() / 2 + "px",
		"margin-top": -($("#boxWrap").height() + 100) / 2 + "px"
	});
}
//邀请好友窗口关闭
function boxWrapColse() {
	$(".boxMask").hide();
	$("#boxWrap").hide()
}

(function($) {
	$.fn.extend({
		Tabs: function(options) {
			// 处理参数
			options = $.extend({
				event: 'mouseover',
				timeout: 0,
				auto: 0,
				callback: null
			}, options);

			var self = $(this),
				tabBox = self.children('div.tab_box').children('div'),
				menu = self.children('ul.tab_menu'),
				items = menu.find('li'),
				timer;

			var tabHandle = function(elem) {
					elem.siblings('li')
						.removeClass('current')
						.end()
						.addClass('current');

					tabBox.siblings('div')
						.addClass('hide')
						.end()
						.eq(elem.index())
						.removeClass('hide');
				},

				delay = function(elem, time) {
					time ? setTimeout(function() {
						tabHandle(elem);
					}, time) : tabHandle(elem);
				},

				start = function() {
					if (!options.auto) return;
					timer = setInterval(autoRun, options.auto);
				},

				autoRun = function() {
					var current = menu.find('li.current'),
						firstItem = items.eq(0),
						len = items.length,
						index = current.index() + 1,
						item = index === len ? firstItem : current.next('li'),
						i = index === len ? 0 : index;

					current.removeClass('current');
					item.addClass('current');

					tabBox.siblings('div')
						.addClass('hide')
						.end()
						.eq(i)
						.removeClass('hide');
				};

			items.bind(options.event, function() {
				delay($(this), options.timeout);
				if (options.callback) {
					options.callback(self);
				}
			});

			if (options.auto) {
				start();
				self.hover(function() {
					clearInterval(timer);
					timer = undefined;
				}, function() {
					start();
				});
			}

			return this;
		}
	});
})(jQuery);

$(document).ready(function() {
	$('.tab_01').Tabs({
		auto: 3000
	});
	$('.tab_02').Tabs();
	$('.tab_03').Tabs();
	$('.tab_04').Tabs();
	$('.tab_05').Tabs();
	$('.tab_06').Tabs();
	$('.tab_07').Tabs();
	$('.tab_08').Tabs();
	$('.tab_09').Tabs();
	$('.tab_100').Tabs({
		event: 'click'
	});

    $('.ajax-get').on('click', function () {
    	var that = $(this);
		if (that.hasClass('confirm')) {
			var confirm = that.attr('confirm');
			if (!confirm) {
				confirm = '确认要执行该操作吗？'
			}
			layer.open({
				content: confirm,
				btn: ['确定', '取消'],
				yes: function(index, layero){
					normal_ajax(that.attr('href'));
					layer.close(tip);
				}
			});
		} else {
			normal_ajax($(this).attr('href'));
		}
        return false;
    });
});

/*placeholder*/
$(document).ready(function() {
	var doc = document,
		inputs = doc.getElementsByTagName('input'),
		supportPlaceholder = 'placeholder' in doc.createElement('input'),
		placeholder = function(input) {
			var text = input.getAttribute('placeholder'),
				defaultValue = input.defaultValue;
			if (defaultValue == '') {
				input.value = text
			}
			input.onfocus = function() {
				if (input.value === text) {
					this.value = ''
				}
			};
			input.onblur = function() {
				if (input.value === '') {
					this.value = text
				}
			}
		};
	if (!supportPlaceholder) {
		for (var i = 0, len = inputs.length; i < len; i++) {
			var input = inputs[i],
				text = input.getAttribute('placeholder');
			if (input.type === 'text' && text) {
				placeholder(input)
			}
		}
	}
});

//menu
(function(a) {
	a.fn.hoverClass = function(b) {
		var a = this;
		a.each(function(c) {
			a.eq(c).hover(function() {
				$(this).addClass(b)
			}, function() {
				$(this).removeClass(b)
			})
		});
		return a
	};
})(jQuery);

$(function() {
	//$(".list-item dt").hoverClass("current");
	$(".shareBox").hoverClass("current");
	$(".user-nav-center").hoverClass("current");
	$("#us-page-btn").hoverClass("current");
});

//登陆
function userlogin(url){
	window.open(url,'loginwindow','height=600,width=800,top=0,left=0,toolbar=no,menubar=no,scrollbars=no,resizable=no,location=no,status=no');
	return false;
}

//获取登录信息
function afterLogin(obj){
	LOGIN_USER_INFO = $.extend(LOGIN_USER_INFO, obj);
	isLogin();
	var html = '<span class="h40 f12 gray2 pl10 fl">发表评论可以得积分哦</span>';
	$('.commentLoginWrap').hide();
	$('.comment-input-action').prepend(html);
}


//表单提交
function frame(obj, delay) {
	delay = arguments[1] ? arguments[1] : 3;
	var SubmitBtn = obj.find("button");
	var SubmitBtnOld = SubmitBtn.text();
	if (obj.hasOwnProperty('valid')) {
		if(!obj.valid()) return false;
	}
	SubmitBtn.attr("disabled", true).text('提交中...').css('background', '#bcbcbd').attr('data-old-name', SubmitBtnOld);
    normal_ajax(obj.attr("action"), obj.serialize(), obj.attr('method') || 'post', SubmitBtn);
	return false;
}

function time(url, t) {
	var wait = t;
	if (wait == 0) {
		wait = t;
		try {
			window.parent.location.href = url;
		} catch (e) {
			window.location.href = url;
		}
	} else {
		wait--;
		setTimeout(function() {
			time(url, wait);
		}, 1000)
	}
}

function showError(){
    var text = arguments[0] || '操作失败';
    layer.alert(text, {
	  icon: 0,
	  time: 3000,
	  btn:0
	});
}

function showSuccess(){
    var text = arguments[0] || '操作成功';
    layer.alert(text, {
	  icon: 1,
	  time: 3000,
	  btn:0
	});
}

function normal_ajax(url, data, method, cb) {
    var delay = 3;
    data = arguments[1] || {};
	data['_ajax'] = 1;
    method = arguments[2] || 'GET';
    $.ajax({
        type: method,
        url: url,
        data: data,
        dataType: "json",
        success: function(data) {
            if (data.code == 1) {
                if (data.msg) {
                    showSuccess(data.msg);
                }
            } else {
				if (data.msg) {
					showError(data.msg);
				}
			}
			if (typeof cb == 'function') {
				cb(data);
			}

            if (data.url) {
                if (data.url == '-1') {
					try {
						window.parent.location.reload();
					} catch (e) {
						document.location.reload();
					}
                } else {
                    var url = data.url;
                    time(url, delay);
                }
            } else {
                if (typeof cb == 'object') {
                    cb.removeAttr("disabled").text(cb.attr('data-old-name')).removeAttr("style");
                }
            }
            if (data.data.refresh) {
				try {
					setTimeout(function() {
						window.parent.location.reload();
					}, delay * 1000);
				} catch (e) {
					setTimeout(function() {
						document.location.reload();
					}, delay * 1000);
				}
            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            /*错误信息处理*/
           if (typeof cb == 'function') {
				cb(data);
			}
           if (typeof cb == 'object') {
                cb.removeAttr("disabled").text(cb.attr('data-old-name')).removeAttr("style");
           }
            //layer.alert(textStatus, {
			//  icon: 0,
	 		//  time: 3000,
	  		//  btn:0
			//});
        }
    });
    return false;
}

function replay(obj1,obj2){
	var myPlayer = videojs(obj1);
	myPlayer.play();
	obj2.parent().hide();
}

function videoclickL(obj){
	obj.hide();
	obj.parent().find('.v_list_2').animate({left:'0'});
	obj.parent().find('.videoBtn_R').show();
}
function videoclickR(obj){
	obj.hide();
	obj.parent().find('.v_list_2').animate({left:'-356px'});
	obj.parent().find('.videoBtn_L').show();
}

//推荐视频
function videoHot(obj){
	if (obj.find('li').length > 1) {
		return;
	}
	var id = obj.attr('id').split('_')[2];
	normal_ajax("/humor/humor/audiorecommend",{id:id},'get', function (data) {
        if (data.code==1) {
        	if(data.data.length<3){
        		obj.css('width','348px');
        		obj.parent().parent().find('.videoBtn_L').hide();
        		obj.parent().parent().find('.videoBtn_R').hide();
        	}else if(2<data.data.length<5){
        		obj.css('width','526px');
        	}else{
        		obj.css('width','704px');
        	}
			if (obj.find('li').length > 1) {
				return;
			}
        	for(var x in data.data){
        		var li = '<li>'+
							'<a href="'+data.data[x].url+'">'+
								'<span class="vjs-icon-play-circle"></span>'+
								'<b>'+data.data[x].title+'</b>'+
								'<img src="'+data.data[x].audio.thumb+'" alt="'+data.data[x].title+'">'+
							'</a>'+
						'</li>';
				obj.append(li);
        	}
        }
  	});
}

//发红包弹出层
function postRedBag(id){
	layerDiv = layer.open({
        type: 2,
        title: false,
        closeBtn: true,
        area: ['450px', '585px'],
        shade: 0.6,
        id: 'postRedBagpro' + id, //设定一个id，防止重复弹出
        moveType: 1, //拖拽模式，0或者1
        content: 'https://www.' + document.domain + '/humor/humor/redBag.html?humor_id=' + id
    });
}

//留言常用语
function setTxt(obj){
	obj.parents('.redbagWrap').find('.setTxtWrap').slideToggle();
}
//选择常用语
function choseTxt(obj){
	obj.parents('.redbagWrap').find('#redbagTxtarea').val(obj.text());
	obj.parents('.setTxtWrap').hide();
}

//支付
function paybackType(obj,obj1){
	obj.on('click','a',function(){
		$(this).addClass('on').siblings().removeClass('on');
		obj1.val($(this).attr('type'));
	});
}



/*
 *分享
 */
$(function(){
	//分享地址
	var qzone = 'http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={url}&title={title}&pics={pic}&summary={content}';
	var sina = 'http://service.weibo.com/share/share.php?url={url}&title={title}&pic={pic}&searchPic=false';
	var tqq = 'http://share.v.t.qq.com/index.php?c=share&a=index&url={url}&title={title}&appkey=801cf76d3cfc44ada52ec13114e84a96';
	//var douban = 'http://www.douban.com/share/service?href={url}&name={title}&text={content}&image={pic}';
	var weixin = 'http://qr.liantu.com/api.php?text={url}'; //接受URL返回图片
	
	$('.bdsharebuttonbox').on('click','a',function(){
		var t = $(this).parent().attr('title');
		var humorId = $(this).parent().attr('humorId');
		var u = 'https://m.pengfu.com/content/'+ humorId +'/'
		var c = t + '（分享自 @捧腹网）';
		var p = $(this).parents('.list-item').find('.content-img').children('img:first').attr('src');
		var e = $(this).attr('type');
		share(e, t, u, c, p);
	})
	
	function share(element, title, url, content, pic){
		var options = {t:title, u:url, c:content, p:pic};
		switch (element){
			case 'weixin':
				showWX(replaceAPI(weixin, options));
				break;
			case 'sina':
				OPenWindow(replaceAPI(sina, options));
				break;
			case 'tQQ':
				OPenWindow(replaceAPI(tqq, options));
				break;
			case 'qZone':
				OPenWindow(replaceAPI(qzone, options));
				break;
			default:
				break;
		}
	}
	
	function replaceAPI(api, options) {
		api = api.replace('{url}', options.u);
		api = api.replace('{title}', options.t);
		api = api.replace('{content}', options.c);
		api = api.replace('{pic}', options.p);
		return api;
	}
	
	function OPenWindow(URL) {
		var openUrl = URL; //弹出窗口的url
		var iWidth = 630; //弹出窗口的宽度;
		var iHeight = 580; //弹出窗口的高度;
		var iTop = (window.screen.availHeight - 30 - iHeight) / 2; //获得窗口的垂直位置;
		var iLeft = (window.screen.availWidth - 10 - iWidth) / 2; //获得窗口的水平位置;
		window.open(openUrl, "", "height=" + iHeight + ", width=" + iWidth + ", top=" + iTop + ", left=" + iLeft + "" + ",toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no");
	}
	
	function showWX(url) {
		var weixing = '<div id="weixin">' +
			'<div class="bd_weixin_popup_head">' +
			'<span>分享到微信朋友圈</span>' +
			'<a href="#" id="close" class="bd_weixin_popup_close">×</a>' +
			'</div>' +
			'<div class="erweima">' +
			'<img class="erweimas" src="" />' +
			'</div>' +
			'<p class="msgs">打开微信，点击右上角的  + ，<br/> 使用“扫一扫”即可将网页分享至朋友圈。</p>' +
			'</div>';
		$("body").append(weixing);
		$(".erweimas").attr('src', url);
		autocenter();
		$("#weixin").show();
	}
	
	function autocenter() {
		var bodyW = parseInt(document.documentElement.clientWidth);
		var bodyH = parseInt(document.documentElement.clientHeight);
		var elW = $("#weixin").width();
		var elH = $("#weixin").height();
		console.log((bodyW - elW) / 2);
		$("#weixin").css("left", (bodyW - elW) / 2);
		$("#weixin").css("top", (bodyH - elH) / 2);
	}
	
	$(document).on('click', "#close", function() {
		$("#weixin").remove();
	});

})


